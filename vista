use venettelecom;

------ vistas del canal con más activaciones  ----


CREATE OR REPLACE VIEW vista_activaciones_por_canal AS
SELECT ca.ID_Canal, ca.Nombre_Canal, COUNT(cu.ID_Cliente) AS total_activaciones
FROM canal ca
JOIN customer cu ON ca.ID_Canal = cu.ID_Canal
GROUP BY ca.ID_Canal, ca.Nombre_Canal
ORDER BY total_activaciones DESC;


--- consulta de la vista -----
SELECT * FROM vista_activaciones_por_canal LIMIT 3;

------- vista para saber el canal de atencion virtual con más recaudación -----

CREATE OR REPLACE VIEW vista_renta_por_canal AS
SELECT 
  ca.ID_Canal,
  ca.Nombre_Canal,
  COUNT(cu.ID_Cliente) AS total_clientes,
  SUM(cu.renta_mensual) AS renta_total_mensual,
  SUM(cu.renta_mensual) * 12 AS renta_total_anual
FROM canal ca
JOIN customer cu ON ca.ID_Canal = cu.ID_Canal
WHERE cu.Estado_servicio = 'A'
GROUP BY ca.ID_Canal, ca.Nombre_Canal
ORDER BY renta_total_anual DESC;


--- consulta de la vista ----

SELECT * FROM vista_renta_por_canal LIMIT 2;


------ consulta de rentas por tecnologia --------

CREATE OR REPLACE VIEW vista_renta_por_tecnologia AS
SELECT 
  ps.tecnologia,
  COUNT(cu.ID_Cliente) AS total_clientes,
  SUM(cu.renta_mensual) AS renta_total_mensual,
  SUM(cu.renta_mensual) * 12 AS renta_total_anual
FROM plan_servicios ps
JOIN customer cu ON cu.ID_PlanServicio = ps.ID_PlanServicio
WHERE cu.Estado_servicio = 'A'
GROUP BY ps.tecnologia
ORDER BY renta_total_anual DESC;


----- consulta de la vista -----
SELECT * FROM vista_renta_por_tecnologia LIMIT 2

---- vistas para el monitoreo de tabla de logs -----

CREATE OR REPLACE VIEW vista_logs_customer AS
SELECT
  Tipo_Accion,
  Fecha,
  Usuario,
  ID_Cliente,
  CONCAT(Nombre, ' ', Apellido) AS Nombre_Cliente,
  DNI,
  Correo,
  Telefono,
  Detalle
FROM log_customer_activity
ORDER BY Fecha DESC;


--- consulta de la vista ----

select * from  vista_logs_customer;

------- vista que agrupa los clientes por región y cuenta cuántos tienen activación registrada. ------
CREATE OR REPLACE VIEW vista_region_mas_activada AS
SELECT
  r.ID_Region,
  r.Nombre_Region,
  COUNT(c.ID_Cliente) AS total_activaciones
FROM region r
JOIN customer c ON c.ID_Region = r.ID_Region
WHERE c.Fecha_activacion IS NOT NULL
GROUP BY r.ID_Region, r.Nombre_Region
ORDER BY total_activaciones DESC;


--- consultar la vista ---
SELECT * FROM vista_region_mas_activada;
