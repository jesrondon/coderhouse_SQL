-- Creación del esquema --
CREATE DATABASE VenetTelecom;
USE VenetTelecom;

-- Tabla: canal--
CREATE TABLE canal (
    ID_Canal INT PRIMARY KEY,
    Nombre_Canal VARCHAR(100) NOT NULL,
    Descripcion VARCHAR(100)
);

-- Tabla: atencion_agente --
CREATE TABLE atencion_agente (
    ID_AtencionAgente INT PRIMARY KEY,
    Tipo_Atencion VARCHAR(50) NOT NULL,
    Nombre_Agente VARCHAR(100),
    Ubicacion VARCHAR(255),
    ID_Estado INT,
    ID_Region INT,
    FOREIGN KEY (ID_Estado) REFERENCES estado(ID_Estado),
    FOREIGN KEY (ID_Region) REFERENCES region(ID_Region)
);

-- Tabla: region --
CREATE TABLE region (
    ID_Region INT PRIMARY KEY,
    Nombre_Region VARCHAR(100) NOT NULL
);

-- Tabla: estado --
CREATE TABLE estado (
    ID_Estado INT PRIMARY KEY,
    Nombre_Estado VARCHAR(100) NOT NULL,
    ID_Region INT NOT NULL,
    FOREIGN KEY (ID_Region) REFERENCES region(ID_Region)
);

-- Tabla: plan_servicios --
CREATE TABLE plan_servicios (
    ID_PlanServicio INT PRIMARY KEY,
    Nombre_PlanServicio VARCHAR(100) NOT NULL,
    Precio DECIMAL(10,2) NOT NULL,
    Duracion VARCHAR(50),
    Fecha_marcaje DATE,
    Estado_Plan VARCHAR(20),
    VIP_CODE INT,
    Modalidad VARCHAR(20),
    Tecnologia VARCHAR(45)
);

-- Tabla: customer --
CREATE TABLE customer (
    ID_Cliente INT PRIMARY KEY,
    Nombre VARCHAR(100) NOT NULL,
    Apellido VARCHAR(100) NOT NULL,
    Razon_Social VARCHAR(100),
    FechaNacimiento DATE,
    DNI VARCHAR(45) NOT NULL,
    Genero VARCHAR(20),
    ID_Canal INT NOT NULL,
    Correo VARCHAR(255),
    Telefono VARCHAR(50),
    Direccion_facturacion VARCHAR(255),
    ID_Region INT NOT NULL,
    ID_Estado INT NOT NULL,
    ID_AtencionAgente INT NOT NULL,
    VIP_CODE INT,
    Fecha_activacion DATE,
    Plan_contratado VARCHAR(45),
    ID_PlanServicio INT,
    Fecha_planServicio DATE,
    Renta_Mensual DECIMAL(10,2),
    Estado_servicio VARCHAR(45),
    FOREIGN KEY (ID_Canal) REFERENCES canal(ID_Canal),
    FOREIGN KEY (ID_AtencionAgente) REFERENCES atencion_agente(ID_AtencionAgente),
    FOREIGN KEY (ID_Region) REFERENCES region(ID_Region),
    FOREIGN KEY (ID_Estado) REFERENCES estado(ID_Estado),
    FOREIGN KEY (ID_PlanServicio) REFERENCES plan_servicios(ID_PlanServicio)
);

-- Tabla: customer_plan (histórico de planes) --
CREATE TABLE customer_plan (
    ID_Cliente INT,
    ID_PlanServicio INT,
    Fecha_Modificacion DATE,
    PRIMARY KEY (ID_Cliente, ID_PlanServicio),
    FOREIGN KEY (ID_Cliente) REFERENCES customer(ID_Cliente),
    FOREIGN KEY (ID_PlanServicio) REFERENCES plan_servicios(ID_PlanServicio)
);

-- Tabla: log_customer_activity (auditoría) --
CREATE TABLE log_customer_activity (
    ID_Log INT AUTO_INCREMENT PRIMARY KEY,
    Tipo_Accion ENUM('SELECT', 'UPDATE', 'DELETE', 'INSERT') NOT NULL,
    Fecha TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    Usuario VARCHAR(100),
    ID_Cliente INT,
    Nombre VARCHAR(100),
    Apellido VARCHAR(100),
    DNI VARCHAR(45),
    Correo VARCHAR(255),
    Telefono VARCHAR(50),
    Detalle TEXT,
    FOREIGN KEY (ID_Cliente) REFERENCES customer(ID_Cliente)
);

